<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shyam MistƒÅn BhandƒÅr - Royal Sweets</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Inter:wght@300;400;600&display=swap');
        
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #FFFBF5; 
        }
        h1, h2, h3 { font-family: 'Playfair Display', serif; }

        /* Animations */
        .fade-in { opacity: 0; transform: translateY(20px); transition: opacity 0.8s ease-out, transform 0.8s ease-out; }
        .fade-in.active { opacity: 1; transform: translateY(0); }
        
        /* Glassmorphism for Admin */
        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* New Order Animation */
        @keyframes pulse-gold {
            0% { box-shadow: 0 0 0 0 rgba(218, 165, 32, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(218, 165, 32, 0); }
            100% { box-shadow: 0 0 0 0 rgba(218, 165, 32, 0); }
        }
        .new-order-card { animation: pulse-gold 2s infinite; border-left: 5px solid #DAA520; }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'royal-maroon': '#800000',
                        'royal-gold': '#DAA520',
                        'warm-cream': '#FFF8E7',
                        'accent-orange': '#D35400'
                    }
                }
            }
        }
    </script>
</head>
<body class="text-gray-800 relative">

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, doc, updateDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
          apiKey: "AIzaSyAMlbdxA2CaOy-mKjLQPiBqTw3jRGV0nLk",
          authDomain: "shyammistanbhandar-81dab.firebaseapp.com",
          projectId: "shyammistanbhandar-81dab",
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const ORDER_PATH = `artifacts/${firebaseConfig.projectId}/public/data/orders`;

        // Silent Login
        signInAnonymously(auth).then(() => console.log("System Ready"));

        // --- 1. ADMIN LOGIC ---
        const ADMIN_PIN = "12346"; // ‚úÖ Updated PIN
        const audioAlert = new Audio("https://actions.google.com/sounds/v1/alarms/beep_short.ogg");

        window.openAdminPanel = () => {
            const input = prompt("üîê Enter Owner PIN:");
            if (input === ADMIN_PIN) {
                document.getElementById('admin-overlay').classList.remove('hidden');
                startLiveOrders();
            } else if (input) {
                alert("‚ùå Galat PIN hai!");
            }
        };

        window.closeAdmin = () => {
            document.getElementById('admin-overlay').classList.add('hidden');
        };

        function startLiveOrders() {
            const q = query(collection(db, ORDER_PATH), orderBy('submittedAt', 'desc'));
            const list = document.getElementById('admin-orders-list');
            let firstRun = true;

            onSnapshot(q, (snapshot) => {
                list.innerHTML = "";
                snapshot.docChanges().forEach((change) => {
                    if (change.type === "added" && !firstRun) {
                        audioAlert.play().catch(e => console.log("Enable sound"));
                    }
                });
                firstRun = false;

                snapshot.forEach((docSnap) => {
                    const data = docSnap.data();
                    const id = docSnap.id;
                    const isNew = data.status === "New Order";
                    
                    const itemRows = data.items.map(i => 
                        `<div class="flex justify-between text-sm border-b border-gray-100 py-1">
                            <span>${i.dishName}</span>
                            <span class="font-bold">x${i.quantity}</span>
                         </div>`
                    ).join('');

                    const card = document.createElement('div');
                    card.className = `bg-white p-4 rounded-lg shadow-md mb-4 transition-all ${isNew ? 'new-order-card' : 'opacity-75'}`;
                    card.innerHTML = `
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-xs font-mono text-gray-500">${new Date(data.submittedAt).toLocaleTimeString()}</span>
                            <span class="px-2 py-0.5 rounded text-xs font-bold ${isNew ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700'}">
                                ${data.status}
                            </span>
                        </div>
                        <div class="mb-3">${itemRows}</div>
                        <div class="bg-gray-50 p-2 rounded text-xs mb-3">
                            <p>üìû <a href="tel:${data.phone}" class="text-blue-600 underline">${data.phone}</a></p>
                            <p>üìç ${data.location}</p>
                            <p class="font-bold text-royal-maroon mt-1">Total Bill: ‚Çπ${data.totalBill || '0'}</p>
                        </div>
                        ${isNew ? `<button onclick="window.markDelivered('${id}')" class="w-full bg-green-600 text-white py-2 rounded text-sm font-bold shadow">‚úÖ Mark Completed</button>` : ''}
                    `;
                    list.appendChild(card);
                });
            });
        }

        window.markDelivered = async (id) => {
            if(confirm("Confirm delivery?")) {
                await updateDoc(doc(db, ORDER_PATH, id), { status: "Delivered" });
            }
        }

        // --- 2. BILLING & ORDER LOGIC ---
        const menuPrices = {
            "Samosa": 5,
            "Rasogallo": 6,
            "Gulab Jamun": 50, // Updated according to your old list
            "Jalebi": 60,
            "Rasmalai": 80,
            "Kaju Katli": 250,
            "Mix Sweets Box": 400
        };

        window.updateTotal = () => {
            const dish = document.getElementById('feat-dish').value;
            const qty = document.getElementById('feat-qty').value;
            const total = (menuPrices[dish] || 0) * qty;
            document.getElementById('live-total').innerText = total;
            return total;
        };

        window.placeOrder = async (e) => {
            e.preventDefault();

            // Time Check (9 AM - 7 PM)
            const now = new Date();
            const hour = now.getHours();
            if (hour < 9 || hour >= 19) {
                alert("‚ö†Ô∏è Maafi chahte hain! Delivery sirf Subah 9:00 AM se Shaam 7:00 PM tak uplabd hai.");
                return;
            }

            const btn = document.getElementById('submit-btn');
            const totalBill = window.updateTotal();
            btn.innerHTML = `<span class="animate-spin inline-block h-4 w-4 border-2 border-white rounded-full border-t-transparent mr-2"></span> Sending...`;
            btn.disabled = true;

            try {
                await addDoc(collection(db, ORDER_PATH), {
                    items: [{ dishName: document.getElementById('feat-dish').value, quantity: document.getElementById('feat-qty').value }],
                    phone: document.getElementById('phone').value,
                    location: document.getElementById('address').value,
                    notes: document.getElementById('notes').value,
                    totalBill: totalBill,
                    status: "New Order",
                    submittedAt: new Date().toISOString()
                });
                alert("üéâ Order Successfully Placed! Bill: ‚Çπ" + totalBill);
                e.target.reset();
                window.updateTotal();
            } catch(err) {
                alert("Error: " + err.message);
            }
            btn.innerHTML = "Confirm Order";
            btn.disabled = false;
        }

        // Initialize Total
        window.addEventListener('DOMContentLoaded', () => window.updateTotal());
    </script>

    <nav class="bg-royal-maroon text-white sticky top-0 z-40 shadow-xl">
        <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
            <div>
                <h1 class="text-2xl font-bold tracking-wide">Shyam MistƒÅn</h1>
                <p class="text-[10px] text-royal-gold tracking-[0.3em] uppercase">Deori, Giridih</p>
            </div>
            <div class="hidden md:flex space-x-8 text-sm font-medium">
                <a href="#home" class="hover:text-royal-gold transition">Home</a>
                <a href="#order" class="bg-royal-gold text-royal-maroon px-4 py-2 rounded-full font-bold hover:bg-white transition">Order Online</a>
            </div>
        </div>
    </nav>

    <section id="home" class="relative bg-warm-cream py-16 px-4 text-center overflow-hidden">
        <div class="fade-in active max-w-4xl mx-auto">
            <span class="text-accent-orange font-bold tracking-widest text-xs uppercase mb-4 block">Open 9:00 AM - 7:00 PM</span>
            <h2 class="text-5xl md:text-7xl font-bold text-royal-maroon mb-6 leading-tight">
                Pure Quality <br/> <span class="text-royal-gold">Sweets & Namkeen</span>
            </h2>
            <p class="text-gray-600 text-lg mb-10 max-w-2xl mx-auto">Authentic flavors from Deori, Giridih. Handcrafted with pure love and tradition.</p>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 max-w-5xl mx-auto mt-12">
                <div class="bg-white p-6 rounded-2xl shadow-lg border-b-4 border-royal-gold transform hover:-translate-y-2 transition">
                    <div class="h-40 bg-gray-100 rounded-xl mb-4 overflow-hidden flex items-center justify-center text-4xl">ü•ü</div>
                    <h3 class="text-xl font-bold text-gray-800">Shahi Samosa</h3>
                    <p class="text-sm text-gray-500 mt-2">Crispy and Spicy. <br><strong>‚Çπ5 / piece</strong></p>
                </div>

                <div class="bg-white p-6 rounded-2xl shadow-lg border-b-4 border-royal-maroon transform hover:-translate-y-2 transition">
                    <div class="h-40 bg-gray-100 rounded-xl mb-4 overflow-hidden flex items-center justify-center text-4xl">‚ö™</div>
                    <h3 class="text-xl font-bold text-gray-800">Rasogallo</h3>
                    <p class="text-sm text-gray-500 mt-2">Soft & Juicy. <br><strong>‚Çπ6 / piece</strong></p>
                </div>

                <div class="bg-white p-6 rounded-2xl shadow-lg border-b-4 border-royal-gold transform hover:-translate-y-2 transition">
                    <div class="h-40 bg-gray-100 rounded-xl mb-4 overflow-hidden flex items-center justify-center text-4xl">üçÆ</div>
                    <h3 class="text-xl font-bold text-gray-800">Kesar Jalebi</h3>
                    <p class="text-sm text-gray-500 mt-2">Hot and Crunchy. <br><strong>‚Çπ60 / plate</strong></p>
                </div>
            </div>
        </div>
    </section>

    <section id="order" class="py-20 bg-white">
        <div class="max-w-3xl mx-auto px-6">
            <div class="text-center mb-10">
                <h2 class="text-4xl font-bold text-royal-maroon">Place Your Order</h2>
                <div class="h-1 w-20 bg-royal-gold mx-auto mt-4"></div>
            </div>

            <div class="bg-white rounded-2xl shadow-2xl p-8 border border-gray-100 relative">
                <form onsubmit="placeOrder(event)" class="space-y-6">
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2 uppercase tracking-wide">Select Your Delight</label>
                        <select id="feat-dish" onchange="updateTotal()" class="w-full bg-gray-50 border border-gray-200 p-4 rounded-xl focus:border-royal-maroon outline-none text-lg font-medium">
                            <option value="Samosa">Samosa (‚Çπ5)</option>
                            <option value="Rasogallo">Rasogallo (‚Çπ6)</option>
                            <option value="Gulab Jamun">Gulab Jamun (‚Çπ50)</option>
                            <option value="Jalebi">Jalebi Rabri (‚Çπ60)</option>
                            <option value="Rasmalai">Rasmalai (‚Çπ80)</option>
                            <option value="Kaju Katli">Kaju Katli (‚Çπ250/250g)</option>
                        </select>
                    </div>

                    <div class="flex gap-4">
                        <div class="w-1/3">
                            <label class="block text-sm font-bold text-gray-700 mb-2">QTY</label>
                            <input type="number" id="feat-qty" value="1" min="1" oninput="updateTotal()" class="w-full bg-gray-50 border p-4 rounded-xl text-center font-bold outline-none focus:border-royal-maroon">
                        </div>
                        <div class="w-2/3">
                            <label class="block text-sm font-bold text-gray-700 mb-2">PHONE NUMBER</label>
                            <input type="tel" id="phone" placeholder="98765..." required class="w-full bg-gray-50 border p-4 rounded-xl outline-none focus:border-royal-maroon">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-2">DELIVERY ADDRESS (DEORI, GIRIDIH)</label>
                        <textarea id="address" rows="2" placeholder="House No, Landmark..." required class="w-full bg-gray-50 border p-4 rounded-xl outline-none focus:border-royal-maroon"></textarea>
                    </div>
                    
                    <div class="bg-royal-maroon/5 p-4 rounded-xl flex justify-between items-center">
                        <span class="font-bold text-gray-600">Estimate Total Bill:</span>
                        <span class="text-2xl font-black text-royal-maroon">‚Çπ<span id="live-total">0</span></span>
                    </div>

                    <button id="submit-btn" class="w-full bg-gradient-to-r from-royal-maroon to-red-800 text-white font-bold py-4 rounded-xl shadow-lg hover:shadow-2xl transition-all">
                        Confirm Order
                    </button>
                    <input type="hidden" id="notes" value="">
                </form>
            </div>
        </div>
    </section>

    <footer class="bg-gray-900 text-white py-12 border-t-4 border-royal-gold">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <h2 class="text-2xl font-serif text-royal-gold mb-2">Shyam MistƒÅn BhandƒÅr</h2>
            <p class="text-gray-400 text-sm mb-2">Serving sweetness since 1995</p>
            <p class="text-xs text-gray-500 mb-6">üìç Deori, Giridih, Jharkhand</p>
            
            <button onclick="openAdminPanel()" class="text-xs text-gray-700 hover:text-gray-500">Owner Login üîí</button>
        </div>
    </footer>

    <div id="admin-overlay" class="hidden fixed inset-0 z-50 bg-black/60 backdrop-blur-sm flex justify-center items-start pt-10 overflow-auto">
        <div class="glass-panel w-full max-w-lg rounded-xl shadow-2xl relative">
            <div class="bg-royal-maroon text-white p-4 rounded-t-xl flex justify-between items-center">
                <h3 class="font-bold text-lg">üõí Live Orders Dashboard</h3>
                <button onclick="closeAdmin()" class="bg-white/20 px-3 py-1 rounded text-sm">‚úï Close</button>
            </div>
            <div class="p-4 bg-gray-50 min-h-[60vh]" id="admin-orders-list">
                <p class="text-center py-10 text-gray-400">Syncing...</p>
            </div>
        </div>
    </div>

    <script>
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) entry.target.classList.add('active');
            });
        });
        document.querySelectorAll('.fade-in').forEach(el => observer.observe(el));
    </script>
</body>
</html>
